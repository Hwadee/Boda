<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--	namespace:mapper的命名空间，一般使用mapper文件的全路径		 -->

<mapper namespace="com.boda.mapper.LoanMapper">

    <resultMap type="com.boda.pojo.Loan" id="LoanResultMap">
        <id column="loan_id" property="loanId"/>
        <result column="customer_id" property="customerId"/>
        <result column="emp_id" property="empId"/>
        <result column="loan_money" property="loanMoney"/>
        <result column="loan_date" property="loanDate"/>
        <result column="loan_state" property="loanState"/>
        <result column="return_date" property="returnDate"/>
        <result column="num_of_stages" property="numOfStages"/>
        <result column="rate_of_interest" property="rateOfInterest"/>

    </resultMap>

    <!--查询所有贷款信息-->
    <select id="findLoan" resultType="com.boda.pojo.Loan">
        SELECT *
        FROM loan
    </select>

    <!--根据id查询贷款信息-->
    <select id="findLoanById" parameterType="Integer" resultType="com.boda.pojo.Loan">
        SELECT DISTINCT *
        FROM loan
        WHERE loan_id = #{value} OR emp_id = #{value} OR customer_id = #{value}
    </select>

    <!-- 根据姓名查询客户所有贷款-->
    <select id="findLoanByName" parameterType="String" resultType="com.boda.pojo.Loan">
        SELECT DISTINCT l.*
        FROM loan l, customer_message c
        WHERE l.customer_id = c.customer_id AND c.customer_name LIKE '%${value}%'
    </select>

    <!-- 根据贷款日期查询贷款信息 -->
    <select id="findLoanByLoanDate" resultType="com.boda.pojo.Loan">
        SELECT *
        FROM loan
        WHERE loan_date >= #{minDate} AND loan_date <![CDATA[<=]]> #{maxDate}
    </select>

    <!-- 根据还款日期查询贷款信息 -->
    <select id="findLoanByReturnDate" resultType="com.boda.pojo.Loan">
        SELECT *
        FROM loan
        WHERE return_date >= #{minDate} AND return_date <![CDATA[<=]]> #{maxDate}
    </select>

    <!-- 根据贷款金额查询贷款信息 -->
    <select id="findLoanByMoney" resultType="com.boda.pojo.Loan">
        SELECT *
        FROM loan
        WHERE loan_money >= #{minAmount} AND loan_money <![CDATA[<=]]> #{maxAmount}
    </select>

    <!-- 插入数据到数据库 -->
    <insert id="addLoan" parameterType="com.boda.pojo.Loan">
        INSERT INTO loan (loan_id, customer_id, emp_id, loan_money, loan_date, loan_state, return_date, number_of_stages, rate_of_interest)
        VALUES
            (#{loanId}, #{customerId}, #{empId}, #{loanMoney}, #{loanDate}, #{loanState}, #{returnDate}, #{numOfStages},
             #{rateOfInterest});
    </insert>

    <!-- 更新贷款状态信息-->
    <update id="updateLoanState" parameterType="com.boda.pojo.Loan">
        UPDATE loan
        SET loan_state = #{loanState}
        WHERE loan_id = #{loanId}
    </update>

</mapper>